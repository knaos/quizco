generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model answers {
  id                String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  team_id           String?    @db.Uuid
  question_id       String?    @db.Uuid
  round_id          String?    @db.Uuid
  submitted_content Json
  is_correct        Boolean?
  score_awarded     Int?       @default(0)
  submitted_at      DateTime?  @default(now()) @db.Timestamptz(6)
  questions         questions? @relation(fields: [question_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  rounds            rounds?    @relation(fields: [round_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  teams             teams?     @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model competitions {
  id         String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title      String              @db.VarChar(255)
  host_pin   String              @db.VarChar(50)
  status     competition_status? @default(DRAFT)
  created_at DateTime?           @default(now()) @db.Timestamptz(6)
  rounds     rounds[]
}

model questions {
  id                 String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  round_id           String?       @db.Uuid
  question_text      String
  type               question_type
  points             Int?          @default(10)
  time_limit_seconds Int?          @default(30)
  content            Json
  grading            grading_mode? @default(AUTO)
  created_at         DateTime?     @default(now()) @db.Timestamptz(6)
  answers            answers[]
  rounds             rounds?       @relation(fields: [round_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([content], map: "idx_questions_content", type: Gin)
}

model rounds {
  id             String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  competition_id String?       @db.Uuid
  order_index    Int
  type           round_type
  title          String?       @db.VarChar(255)
  created_at     DateTime?     @default(now()) @db.Timestamptz(6)
  answers        answers[]
  questions      questions[]
  competitions   competitions? @relation(fields: [competition_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model teams {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name       String    @unique @db.VarChar(255)
  color      String?   @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  answers    answers[]
}

enum competition_status {
  DRAFT
  ACTIVE
  COMPLETED
}

enum grading_mode {
  AUTO
  MANUAL
}

enum question_type {
  CLOSED
  MULTIPLE_CHOICE
  OPEN_WORD
  CROSSWORD
}

enum round_type {
  STANDARD
  CROSSWORD
  SPEED_RUN
}
